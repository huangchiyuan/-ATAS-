# 柱状图可视化说明

## ✅ 已完成的改进

### 从折线图改为柱状图（能量柱）

**改进前**：折线图显示 Spread 值  
**改进后**：柱状图（能量柱）显示 Spread 值，更加直观

---

## 📊 柱状图显示方式

### 1. 双柱并排显示

每个时间点显示**两个能量柱**：

- **黄色柱子**：Kalman 滤波的 Spread 值
- **青色柱子**：Ridge 回归的 Spread 值

两个柱子**并排显示**，便于对比两个模型的 Spread 差异。

---

### 2. 柱状图的含义

**柱子从 0 轴开始延伸**：

- **向上延伸（正值区域）**：
  - Spread > 0
  - 理论价 > 实际价
  - 潜在做多机会（绿色阈值线上方）

- **向下延伸（负值区域）**：
  - Spread < 0
  - 理论价 < 实际价
  - 潜在做空机会（红色阈值线下方）

---

### 3. 柱子的高度

**柱子的高度 = |Spread|**

- 柱子越高（或越低）→ Spread 的绝对值越大 → 套利机会越大
- 柱子接近 0 轴 → Spread 接近 0 → 无套利机会

---

## 🎨 视觉效果

### 颜色编码

- **黄色柱子**（#FFD700）：Kalman Spread
- **青色柱子**（#00BCD4）：Ridge Spread
- **绿色虚线**：做多阈值线（+0.75 tick）
- **红色虚线**：做空阈值线（-0.75 tick）
- **灰色虚线**：0 轴参考线

### 透明度设置

- 柱子使用 180 的 alpha 值，半透明显示
- 便于重叠时也能看到两个模型的数据

---

## 🔍 如何阅读柱状图

### 场景 1：观察信号强度

**查看柱子的高度**：

```
柱子很高（向上）→ Spread 很大 → 很强的做多信号
柱子很低（向下）→ Spread 很大（负值）→ 很强的做空信号
柱子接近 0 → Spread 很小 → 无信号
```

### 场景 2：对比两个模型

**并排对比两个柱子**：

```
两个柱子高度相近 → 两个模型意见一致 → 信号可靠
两个柱子高度差异很大 → 两个模型意见分歧 → 需要谨慎
```

### 场景 3：判断信号触发

**观察柱子与阈值线的关系**：

```
黄色柱子 > 绿色虚线 → Kalman 触发做多信号
黄色柱子 < 红色虚线 → Kalman 触发做空信号
青色柱子 > 绿色虚线 → Ridge 触发做多信号
青色柱子 < 红色虚线 → Ridge 触发做空信号
```

---

## 💡 柱状图的优势

### 1. 更直观

- **高度 = 强度**：一眼就能看出 Spread 的大小
- **方向 = 信号方向**：向上做多，向下做空

### 2. 便于对比

- **并排显示**：两个模型的数据直接对比
- **高度差异**：直观看出两个模型的 Spread 差异

### 3. 快速判断

- **柱子的高度**：快速判断信号强度
- **柱子的方向**：快速判断做多还是做空

---

## 📊 图表布局

```
信号监控 (Spread vs Threshold)
┌─────────────────────────────────────┐
│  图例:                               │
│  ████ 黄色: Kalman Spread            │
│  ████ 青色: Ridge Spread             │
│                                      │
│  ─────── 绿色虚线: 做多阈值 (+0.75)  │
│                                      │
│  ████  ↑ 向上延伸 = 做多信号         │
│  ████  ↑                              │
│  ─────── 0 轴参考线                  │
│  ████  ↓                              │
│  ████  ↓ 向下延伸 = 做空信号         │
│                                      │
│  ─────── 红色虚线: 做空阈值 (-0.75)  │
└─────────────────────────────────────┘
```

每个时间点显示两个并排的柱子（黄色 + 青色）。

---

## ⚙️ 技术实现

### BarGraphItem 配置

- **width**: 0.35（每个柱子的宽度，两个并排显示）
- **x 偏移**: 
  - Kalman: `x - 0.175`（向左偏移）
  - Ridge: `x + 0.175`（向右偏移）
- **height**: Spread 值（可以是正数或负数）

### 数据更新

每次收到新的 Spread 值时：
1. 添加到历史数据列表
2. 更新柱状图的 x 和 height 数据
3. 两个模型的柱子并排显示

---

## 🔗 相关文档

- **仪表盘使用说明**：`仪表盘使用说明.md`
- **可视化图表说明**：`可视化图表说明.md`
- **Ridge 功能说明**：`岭回归可视化说明.md`

---

**最后更新**：2025-01-19  
**版本**：v1.2（柱状图版本）

