# 实时能量柱可视化说明

## ✅ 改进内容

### 从历史折线图改为实时能量柱

**改进前**：
- 一个图表显示多条历史曲线
- 保留最近 1000 个数据点
- 显示时间序列

**改进后**：
- **两个独立的图表**，每个显示一个实时能量柱
- **不保留历史数据**，只显示当前值
- 实时更新，像进度条一样直观

---

## 📊 界面布局

### 两个独立的实时能量柱图表

```
┌─────────────────────────────────────────────┐
│  实时 Spread 能量柱                         │
├──────────────────┬──────────────────────────┤
│  Kalman Spread   │   Ridge Spread           │
│                  │                          │
│  ───── 绿阈值    │   ───── 绿阈值           │
│                  │                          │
│     ████ ↑       │      ████ ↑              │
│                  │                          │
│  ───── 0轴       │   ───── 0轴              │
│                  │                          │
│     ████ ↓       │      ████ ↓              │
│                  │                          │
│  ───── 红阈值    │   ───── 红阈值           │
└──────────────────┴──────────────────────────┘
```

---

## 🎨 图表特性

### 1. Kalman 能量柱（左侧）

- **标题**：Kalman Spread（黄色）
- **颜色**：黄色柱子（#FFD700）
- **显示内容**：当前 Kalman Spread 值
- **更新方式**：实时更新，不保留历史

### 2. Ridge 能量柱（右侧）

- **标题**：Ridge Spread（青色）
- **颜色**：青色柱子（#00BCD4）
- **显示内容**：当前 Ridge Spread 值
- **更新方式**：实时更新，不保留历史

---

## 📈 能量柱的含义

### 柱子的方向

- **向上延伸（正值区域）**：
  - Spread > 0
  - 理论价 > 实际价
  - 潜在做多机会
  
- **向下延伸（负值区域）**：
  - Spread < 0
  - 理论价 < 实际价
  - 潜在做空机会

### 柱子的高度

- **高度 = |Spread|**
- 柱子越高（或越低）→ Spread 的绝对值越大 → 信号越强
- 柱子接近 0 轴 → Spread 接近 0 → 无信号

---

## 🔍 如何阅读

### 场景 1：观察当前信号

**看两个能量柱的高度和方向**：

```
黄色柱子很高（向上）→ Kalman 给出强做多信号
青色柱子很高（向下）→ Ridge 给出强做空信号

如果两个柱子方向一致 → 信号可靠
如果两个柱子方向相反 → 信号分歧，需谨慎
```

### 场景 2：判断信号触发

**观察柱子与阈值线的关系**：

```
柱子 > 绿色虚线 → 触发做多信号
柱子 < 红色虚线 → 触发做空信号
柱子在两线之间 → 等待信号
```

### 场景 3：对比两个模型

**并排对比两个能量柱**：

```
两个柱子高度相近 → 两个模型意见一致 → 信号可靠
两个柱子高度差异很大 → 两个模型意见分歧 → 需要谨慎
```

---

## ⚙️ 技术实现

### 数据存储

- **不保留历史数据**：只存储当前值
  - `self.current_spread_kalman`: Kalman 当前 Spread（tick）
  - `self.current_spread_ridge`: Ridge 当前 Spread（tick）

### 图表更新

- **实时更新**：每次收到新数据时立即更新柱子高度
- **单柱显示**：每个图表只显示一个柱子（x=0 位置）
- **无历史轨迹**：不绘制历史数据，只显示当前状态

### 性能优势

- **内存占用小**：不存储历史数据
- **更新速度快**：只更新单个柱子
- **显示清晰**：专注于当前状态

---

## 💡 使用场景

### 场景 1：实时监控

**目的**：在实盘中快速判断当前信号

**操作**：
1. 观察两个能量柱的高度
2. 判断是否超过阈值线
3. 结合状态灯和顶部指令做出交易决策

### 场景 2：参数调优

**目的**：实时调整参数，观察信号变化

**操作**：
1. 拖动参数滑块
2. 观察能量柱的变化
3. 找到最佳参数组合

### 场景 3：模型对比

**目的**：对比两个模型的 Spread 差异

**操作**：
1. 并排查看两个能量柱
2. 判断两个模型的信号是否一致
3. 只在双重确认时执行交易

---

## 📊 图表元素

### 每个图表包含

1. **标题**：模型名称（Kalman Spread / Ridge Spread）
2. **Y 轴**：Spread (Ticks) 刻度
3. **0 轴参考线**：灰色虚线
4. **绿色阈值线**：做多触发线（+0.75 tick）
5. **红色阈值线**：做空触发线（-0.75 tick）
6. **能量柱**：当前 Spread 值（黄色/青色）

---

## 🔗 相关文档

- **仪表盘使用说明**：`仪表盘使用说明.md`
- **可视化图表说明**：`可视化图表说明.md`
- **Ridge 功能说明**：`岭回归可视化说明.md`

---

**最后更新**：2025-01-19  
**版本**：v2.0（实时能量柱版本）

