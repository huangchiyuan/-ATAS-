# æ‰¹é‡å›æµ‹ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ‰¹é‡å›æµ‹ç³»ç»Ÿå…è®¸ä½ åŒæ—¶æµ‹è¯•å¤šä¸ªé…ç½®ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šã€‚æ”¯æŒï¼š

- âœ… **æ¨¡å‹é€‰æ‹©**ï¼šKalmanã€Ridge æˆ–ä¸¤è€…åŒæ—¶ä½¿ç”¨
- âœ… **å‚æ•°å¯¹æ¯”**ï¼šSpread é˜ˆå€¼ã€OBI é˜ˆå€¼ã€é˜Ÿåˆ—é™åˆ¶ç­‰
- âœ… **æ­¢ç›ˆæ­¢æŸé…ç½®**ï¼šå¯é…ç½®ä¸åŒçš„ TP/SL ç‚¹æ•°
- âœ… **è¿½è¸ªæ—¶é•¿é…ç½®**ï¼šå¯é…ç½®ä¸åŒçš„è¿½è¸ªæ—¶é•¿
- âœ… **è‡ªåŠ¨å¯¹æ¯”æŠ¥å‘Š**ï¼šç”Ÿæˆæ‰€æœ‰é…ç½®çš„å¯¹æ¯”ç»Ÿè®¡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
python run_backtest_suite.py
```

### 2. è‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `run_backtest_suite.py` ä¸­çš„ `create_test_configs()` å‡½æ•°ï¼Œæ·»åŠ ä½ çš„é…ç½®ï¼š

```python
def create_test_configs() -> List[BacktestConfig]:
    """åˆ›å»ºæµ‹è¯•é…ç½®åˆ—è¡¨"""
    configs = []
    
    # é…ç½®1ï¼šé»˜è®¤ Kalman
    configs.append(BacktestConfig(
        name="Kalman_é»˜è®¤",
        pricing_model=PricingModel.KALMAN,
        track_duration=10.0,
        tp_ticks=2.0,
        sl_ticks=-3.0,
    ))
    
    # é…ç½®2ï¼šè‡ªå®šä¹‰å‚æ•°
    configs.append(BacktestConfig(
        name="Kalman_ä¿å®ˆ",
        pricing_model=PricingModel.KALMAN,
        maker_config=MakerConfig(
            base_spread_threshold=1.0,
            min_obi_for_long=0.15,
        ),
        track_duration=10.0,
        tp_ticks=2.0,
        sl_ticks=-3.0,
    ))
    
    return configs
```

---

## âš™ï¸ é…ç½®å‚æ•°è¯´æ˜

### BacktestConfig å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `name` | str | é…ç½®åç§°ï¼ˆç”¨äºæ ‡è¯†å’ŒæŠ¥å‘Šï¼‰ | **å¿…éœ€** |
| `pricing_model` | PricingModel | å®šä»·æ¨¡å‹é€‰æ‹©ï¼ˆKALMAN/RIDGE/BOTHï¼‰ | `KALMAN` |
| `maker_config` | MakerConfig | ç­–ç•¥ä¸»å¼•æ“é…ç½® | `None`ï¼ˆä½¿ç”¨é»˜è®¤ï¼‰ |
| `kalman_config` | KalmanConfig | Kalman æ¨¡å‹é…ç½® | `None`ï¼ˆä½¿ç”¨é»˜è®¤ï¼‰ |
| `ridge_config` | RidgeConfig | Ridge æ¨¡å‹é…ç½® | `None`ï¼ˆä½¿ç”¨é»˜è®¤ï¼‰ |
| `track_duration` | float | è¿½è¸ªæ¯ä¸ªä¿¡å·çš„æœ€å¤§æ—¶é•¿ï¼ˆç§’ï¼‰ | `10.0` |
| `tp_ticks` | float | è™šæ‹Ÿæ­¢ç›ˆç‚¹æ•° | `2.0` |
| `sl_ticks` | float | è™šæ‹Ÿæ­¢æŸç‚¹æ•°ï¼ˆè´Ÿæ•°ï¼‰ | `-3.0` |
| `tick_size` | float | æœ€å°è·³åŠ¨ç‚¹æ•°ï¼ˆES=0.25ï¼‰ | `0.25` |

### PricingModel æšä¸¾

- `PricingModel.KALMAN`ï¼šä½¿ç”¨ Kalman æ»¤æ³¢æ¨¡å‹
- `PricingModel.RIDGE`ï¼šä½¿ç”¨ Ridge å›å½’æ¨¡å‹
- `PricingModel.BOTH`ï¼šåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹ï¼ˆå¾…å®ç°ï¼‰

---

## ğŸ“Š è¾“å‡ºè¯´æ˜

### 1. å•ä¸ªé…ç½®çš„è¯¦ç»†æŠ¥å‘Š

æ¯ä¸ªé…ç½®ä¼šç”Ÿæˆä¸€ä¸ª CSV æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- æ‰€æœ‰ä¿¡å·çš„è¯¦ç»†ä¿¡æ¯
- MFE/MAE æ•°æ®
- æ—¶é—´ç‚¹å¿«ç…§ï¼ˆ1sã€5sã€10sã€30sï¼‰

æ–‡ä»¶åæ ¼å¼ï¼š`backtest_{é…ç½®åç§°}_{æ—¶é—´æˆ³}.csv`

### 2. å¯¹æ¯”æŠ¥å‘Š

ç¨‹åºç»“æŸåï¼Œä¼šæ‰“å°æ‰€æœ‰é…ç½®çš„å¯¹æ¯”ç»Ÿè®¡ï¼š

```
====================================================================================================
ğŸ“Š æ‰¹é‡å›æµ‹å¯¹æ¯”æŠ¥å‘Š (Batch Backtest Comparison)
====================================================================================================
é…ç½®åç§°                | ä¿¡å·æ•°    | èƒœç‡%     | è´¥ç‡%     | è¶…æ—¶%     | å¹³å‡PnL     | å¹³å‡MFE     | å¹³å‡MAE     | å¹³å‡æ—¶é•¿
----------------------------------------------------------------------------------------------------
Kalman_é»˜è®¤             |      144  |   39.6%   |   19.4%   |   41.0%   |     0.13t   |     1.11t   |    -1.03t   |    6.54s
Kalman_ä¿å®ˆ             |       89  |   45.2%   |   15.7%   |   39.1%   |     0.28t   |     1.35t   |    -0.89t   |    7.12s
Kalman_æ¿€è¿›             |      203  |   32.5%   |   24.6%   |   42.9%   |     0.05t   |     0.98t   |    -1.18t   |    6.21s
====================================================================================================
```

---

## ğŸ¯ é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæµ‹è¯•ä¸åŒçš„ Spread é˜ˆå€¼

```python
configs = []

for threshold in [0.3, 0.5, 0.7, 1.0]:
    configs.append(BacktestConfig(
        name=f"é˜ˆå€¼_{threshold}",
        pricing_model=PricingModel.KALMAN,
        maker_config=MakerConfig(
            base_spread_threshold=threshold,
        ),
        track_duration=10.0,
        tp_ticks=2.0,
        sl_ticks=-3.0,
    ))
```

### ç¤ºä¾‹ 2ï¼šæµ‹è¯•ä¸åŒçš„æ­¢ç›ˆæ­¢æŸ

```python
configs = []

tp_sl_pairs = [(2.0, -3.0), (2.0, -4.0), (3.0, -3.0), (3.0, -4.0)]

for tp, sl in tp_sl_pairs:
    configs.append(BacktestConfig(
        name=f"TP{tp}_SL{abs(sl)}",
        pricing_model=PricingModel.KALMAN,
        track_duration=10.0,
        tp_ticks=tp,
        sl_ticks=sl,
    ))
```

### ç¤ºä¾‹ 3ï¼šæµ‹è¯•ä¸åŒçš„è¿½è¸ªæ—¶é•¿

```python
configs = []

for duration in [5.0, 10.0, 15.0, 30.0]:
    configs.append(BacktestConfig(
        name=f"è¿½è¸ª{duration}s",
        pricing_model=PricingModel.KALMAN,
        track_duration=duration,
        tp_ticks=2.0,
        sl_ticks=-3.0,
    ))
```

### ç¤ºä¾‹ 4ï¼šæµ‹è¯• Kalman å‚æ•°

```python
configs = []

for r_obs in [0.5, 1.0, 2.0, 5.0]:
    configs.append(BacktestConfig(
        name=f"Kalman_R{r_obs}",
        pricing_model=PricingModel.KALMAN,
        kalman_config=KalmanConfig(r_obs=r_obs),
        track_duration=10.0,
        tp_ticks=2.0,
        sl_ticks=-3.0,
    ))
```

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰è¿è¡Œæ—¶é•¿

é»˜è®¤æ¯ä¸ªé…ç½®è¿è¡Œ 60 ç§’ï¼Œå¯ä»¥ä¿®æ”¹ï¼š

```python
runner.run(duration_seconds=120.0)  # è¿è¡Œ 2 åˆ†é’Ÿ
```

### 2. å¹¶è¡Œè¿è¡Œï¼ˆå¾…å®ç°ï¼‰

ç›®å‰æ˜¯ä¸²è¡Œè¿è¡Œï¼Œæœªæ¥å¯ä»¥æ”¯æŒå¹¶è¡Œè¿è¡Œå¤šä¸ªé…ç½®ï¼ˆéœ€è¦å¤šè¿›ç¨‹æˆ–å¼‚æ­¥å¤„ç†ï¼‰ã€‚

### 3. ç»“æœå¯¼å‡º

å¯ä»¥æ‰©å±•ä»£ç ï¼Œå°†å¯¹æ¯”ç»“æœå¯¼å‡ºä¸º CSV æˆ– Excelï¼š

```python
import pandas as pd

# å°†ç»“æœè½¬æ¢ä¸º DataFrame
df = pd.DataFrame([{
    'é…ç½®åç§°': r.config.name,
    'ä¿¡å·æ•°': r.total_signals,
    'èƒœç‡': r.win_rate(),
    'å¹³å‡PnL': r.avg_pnl,
    ...
} for r in results])

df.to_csv('å¯¹æ¯”æŠ¥å‘Š.csv', index=False, encoding='utf-8-sig')
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æº**ï¼šç¡®ä¿ ATAS æ­£åœ¨å›æ”¾æ•°æ®ï¼Œå¹¶ä¸” UDP ç«¯å£æ­£ç¡®
2. **è¿è¡Œæ—¶é•¿**ï¼šæ¯ä¸ªé…ç½®çš„è¿è¡Œæ—¶é•¿åº”è¯¥è¶³å¤Ÿé•¿ï¼Œä»¥æ”¶é›†è¶³å¤Ÿçš„ä¿¡å·
3. **é…ç½®æ•°é‡**ï¼šä¸è¦åˆ›å»ºå¤ªå¤šé…ç½®ï¼Œå¦åˆ™è¿è¡Œæ—¶é—´ä¼šå¾ˆé•¿
4. **å†…å­˜ä½¿ç”¨**ï¼šæ¯ä¸ªé…ç½®éƒ½ä¼šä¿å­˜è¯¦ç»†çš„ CSV æŠ¥å‘Šï¼Œæ³¨æ„ç£ç›˜ç©ºé—´

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ²¡æœ‰æ”¶åˆ°æ•°æ®

- æ£€æŸ¥ ATAS æ˜¯å¦æ­£åœ¨å›æ”¾
- æ£€æŸ¥ UDP ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ 5555ï¼‰
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰æ•°æ®æ¥æ”¶æ—¥å¿—

### é—®é¢˜ï¼šæ‰€æœ‰é…ç½®éƒ½æ²¡æœ‰ä¿¡å·

- æ£€æŸ¥ç­–ç•¥å‚æ•°æ˜¯å¦åˆç†
- æŸ¥çœ‹å•ä¸ªé…ç½®çš„è¯¦ç»†æŠ¥å‘Šï¼Œäº†è§£åŸå› 
- å¯èƒ½éœ€è¦é™ä½ Spread é˜ˆå€¼

### é—®é¢˜ï¼šè¿è¡Œæ—¶é—´å¤ªé•¿

- å‡å°‘é…ç½®æ•°é‡
- ç¼©çŸ­æ¯ä¸ªé…ç½®çš„è¿è¡Œæ—¶é•¿
- ä½¿ç”¨æ›´å¿«çš„å›æ”¾é€Ÿåº¦

---

**æœ€åæ›´æ–°**ï¼š2025-01-19

