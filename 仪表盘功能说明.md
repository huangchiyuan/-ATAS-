# 策略驾驶舱功能说明

## ✅ 已完成的功能

### 1. 核心可视化功能

✅ **Spread 信号图表**
- 实时显示 Spread 曲线（黄色）
- 动态阈值线（绿色=做多，红色=做空）
- 0 轴参考线
- 滚动显示最近 1000 个数据点

✅ **红绿灯式状态显示**
- Model Spread：核心信号状态（绿/红/灰）
- OBI Flow：订单簿失衡状态
- Iceberg：冰山订单检测状态
- BTC Risk：BTC 风险监控状态

✅ **实时价格显示**
- ES、NQ、YM、BTC 实时价格
- 自动格式化显示

✅ **大字指令提示**
- 绿色：买入信号
- 红色：卖出信号
- 黄色：信号被过滤
- 灰色：等待状态

---

### 2. 实时参数调整

✅ **Spread 阈值**
- 范围：0.25 - 5.0 tick
- 实时生效，阈值线立即更新

✅ **Kalman R（观测噪声）**
- 范围：1.0 - 1000.0
- 实时生效，影响模型响应速度

✅ **OBI 阈值**
- 范围：0.0 - 0.8
- 实时生效，过滤器立即生效

✅ **Kalman Q Beta**
- 范围：1e-15 - 1e-8
- 需要重启模型才能完全生效

---

### 3. 数据集成

✅ **UDP 数据接收**
- 自动从 ATAS 接收 Tick 和 DOM 数据
- 支持加速回放（10x、100x、500x）
- 队列缓冲，防止数据丢失

✅ **DOM 解析**
- 使用 `InstrumentState` 解析订单簿
- 支持多档深度解析
- 自动过滤无效数据

✅ **策略引擎集成**
- 完整集成 `NordenMakerV3` 引擎
- 实时计算 Spread、OBI、Iceberg 等指标
- 自动触发过滤器和信号生成

---

## 📊 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  区域 1: 顶部指令区 (大字显示：BUY/SELL/WAIT)              │
├─────────────────────────────────────────────────────────────┤
│  区域 2: 价格显示面板 (ES | NQ | YM | BTC)                  │
├─────────────────────────────────────────────────────────────┤
│  区域 3: 过滤器状态矩阵 (4 个红绿灯)                        │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  区域 4: Spread 信号图表 (黄色曲线 + 阈值线)                │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│  区域 5: 实时参数调整面板 (4 个滑块/输入框)                 │
└─────────────────────────────────────────────────────────────┘
```

---

## 🎯 使用场景

### 场景 1：参数调优
- 观察 Spread 曲线波动
- 实时调整阈值和 Kalman 参数
- 查看信号触发频率
- 优化参数组合

### 场景 2：策略理解
- 查看过滤器状态，理解信号被拦截的原因
- 观察 Spread 大小，评估信号强度
- 查看价格关系，理解市场状态

### 场景 3：实盘监控
- 副屏显示，实时监控策略状态
- 大字提示，快速识别交易信号
- 风险监控，及时发现异常波动

---

## 🔧 技术特点

### 性能优化
- **高刷新率**：33 FPS（30ms 刷新间隔）
- **批量处理**：每次处理最多 200 个事件
- **滚动窗口**：只保留最近 1000 个数据点
- **队列缓冲**：防止数据丢失

### 用户体验
- **红绿灯式显示**：直观的颜色编码
- **实时参数调整**：无需重启即可修改参数
- **大字指令提示**：清晰可见的交易信号
- **暗色主题**：适合长时间观看

### 代码质量
- **模块化设计**：UI 组件独立封装
- **错误处理**：优雅处理异常情况
- **类型提示**：完整的类型注解
- **文档完善**：详细的使用说明

---

## 📝 文件清单

1. **`run_dashboard_gui.py`** - 仪表盘主程序
2. **`仪表盘使用说明.md`** - 详细使用文档
3. **`仪表盘功能说明.md`** - 功能清单（本文件）

---

## 🚀 快速开始

### 安装依赖
```bash
pip install PyQt6 pyqtgraph
```

### 启动仪表盘
```bash
python run_dashboard_gui.py
```

### 确保数据源运行
- ATAS 平台的 NFQE_Bridge_UDP 指标必须运行
- UDP 端口：5555（默认）

---

## ⚠️ 注意事项

1. **数据要求**
   - ES 和 NQ 价格是必需的
   - YM 和 BTC 是可选的
   - DOM 数据用于 OBI 和冰山检测

2. **参数调整**
   - Spread 阈值、OBI 阈值：立即生效
   - Kalman R：立即生效（可能需要几个 tick 完全生效）
   - Kalman Q Beta：需要重启模型才能完全生效

3. **性能**
   - 建议在性能较好的机器上运行
   - 关闭其他占用资源的程序
   - 如果卡顿，可以减少历史数据长度

---

## 🔗 相关文档

- **详细使用说明**：`仪表盘使用说明.md`
- **策略配置**：`norden_v3/配置参数说明.md`
- **项目总览**：`README.md`

---

**版本**：v1.0  
**最后更新**：2025-01-19

