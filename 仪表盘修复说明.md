# 仪表盘错误修复说明

## 问题描述

运行时出现错误：
```
AttributeError: 'QDoubleSpinBox' object has no attribute 'setDisplayMode'
```

## 原因

`QDoubleSpinBox` 在 PyQt6 中不支持 `setDisplayMode()` 方法。这个方法在某些版本的 PyQt 中可能不存在或者已经被移除。

## 解决方案

### 已修复的内容

1. **移除了 `setDisplayMode` 调用**
   - 原代码：`self.spin_q_beta.setDisplayMode(QDoubleSpinBox.DisplayMode.ScientificNotation)`
   - 已删除

2. **改用对数形式输入 Q Beta 参数**
   - 原方式：直接输入极小值（如 1e-12），显示困难
   - 新方式：使用对数形式，输入 -12 表示 10^-12 = 1e-12
   - 范围：-15 到 -8（对应 1e-15 到 1e-8）
   - 显示后缀：`(10^N)`

3. **更新了参数处理逻辑**
   - 在 `update_params()` 方法中，将对数形式的输入转换为实际值
   - `actual_value = 10.0 ** log_value`

## 当前代码状态

Q Beta 参数现在使用以下方式：

```python
# 4. Kalman Q Beta
self.spin_q_beta = QDoubleSpinBox()
self.spin_q_beta.setRange(-15, -8)  # 对数形式
self.spin_q_beta.setSingleStep(1)
self.spin_q_beta.setValue(-12)  # 表示 1e-12
self.spin_q_beta.setDecimals(0)
self.spin_q_beta.setSuffix(" (10^N)")  # 显示提示
```

参数更新：
```python
# 将对数形式转换为实际值
log_value = self.spin_q_beta.value()  # 例如：-12
actual_value = 10.0 ** log_value      # 例如：1e-12
self.kalman_cfg.q_beta = actual_value
```

## 使用说明

### Q Beta 参数输入方式

- **输入 -12** = 1e-12（默认值）
- **输入 -15** = 1e-15（最小值，更稳定）
- **输入 -8** = 1e-8（最大值，更灵活）

### 如果仍然看到错误

1. **重新加载文件**：在 IDE 中重新打开 `run_dashboard_gui.py`
2. **检查文件版本**：确认文件第 319 行应该是 `self.spin_q_beta.setValue(-12)`
3. **清除 Python 缓存**：删除 `__pycache__` 文件夹
4. **重新运行**：`python run_dashboard_gui.py`

## 验证修复

运行以下命令检查语法是否正确：

```bash
python -m py_compile run_dashboard_gui.py
```

如果没有错误输出，说明语法正确。

---

**修复日期**：2025-01-19  
**状态**：✅ 已修复

